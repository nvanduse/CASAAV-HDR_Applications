# CASAAV-HDR_Applications
Scripts for CASAAV-HDR applications manuscript.
Excerpts from the manuscript methods section describing each analysis are below:

Analysis of calcium transients
Standard transient characteristics were calculated as previously described66, from five cycles. Briefly, cells were manually segmented, and the mean intensity of each segmented cell over time was input into a custom MATLAB (Mathworks) script for data filtering and calcium transient parameter calculation. Data filtration was performed by removing photobleaching and applying a median filter. After normalizing data to baseline and identifying peaks via the MATLAB findpeaks function, parameter calculations included amplitude, maximal upstroke velocity, maximal downstroke velocity, and time from peak to 50% decay in calcium transient. For analysis of calcium abnormalities, unaveraged traces of the five recorded cycles were uploaded to AnomalyExplorer. For a small number of cells, technical problems resulted in premature termination of recording prior to acquisition of five full cycles; these cells were excluded. AnomalyExplorer allows for data exploration via real-time visualization of anomalies across adjustable analysis specifications. We explored the frequency of the various anomaly types detected by AnomalyExplorer across a range of specifications, and noted an increase of “low peaks”. This was most apparent when normal peak height was stringently defined (low peaks = 10-94%; Fig. 3H). Visual inspection of the data suggested there was an overall increase in amplitude variation, rather than a small number of low peaks, so we directly measured variation by extracting calcium peak coordinates for each cardiomyocyte, fitting them with a best fit line, and measuring the distance of each peak from the line. This distance was normalized to peak height and plotted. A script used for the analysis is available on Github (see data availability statement).

Genomically integrated MPRA
A total of fifty-five enhancers with activity in cardiomyocytes (25), cardiac endothelial cells (25), or mouse embryonic stem cells (5), were selected from the literature or the VISTA Enhancer Database (Supp. Table 4). P300 ChIP-seq datasets from each cell type were mined and analyzed for each full length enhancer, and a 400 bp interval most overlapping with P300 occupancy was selected. These 400 bp regions, along with a 3’ barcode, were synthesized by Twist Biosciences. Synthesized enhancers were ligated into the Tnni1 HDR donor vector (Supp. Table 6), and sequenced to confirm successful cloning. One endothelial enhancer was missing, possibly due to failed synthesis. We proceeded to package the plasmid pool into AAV9, and injected 1x10^12 vg into newborn cTnnt2-Cre(+); R26fsCas9-P2A-GFP mice, as described above. Hearts were collected at P28 and dissociated into single cell suspensions. A small fraction of cardiomyocytes from each heart was seeded in DMEM, fixed, and stained for the HA-tag. The remaining cardiomyocytes for each heart were divided into two portions, with genomic DNA being isolated from one portion and RNA isolated from the other, as described above.  For preparation of amplicon-seq libraries from RNA, for each mouse, duplicate 2ug RNA samples were reverse transcribed using Oligo-dT with SMARTScribe Reverse Transcriptase (Takara 639537) following the manufacturer instructions. For each cDNA sample, 5ul of cDNA was amplified in duplicate Phusion Hot Start Flex (NEB M0536L) reactions, with a touchdown protocol for 15 cycles, decreasing 1°C per cycle from 70°C to 55°C annealing temperature. The forward primer targeted a priming site situated between the enhancer and barcode, while the reverse primer targeted the Tnni3 UTR downstream of the HDR-vector homology arm (Fig. 4B, red arrows). The forward primer added a full length NGS adapter via primer tailing, while the reverse primer added a partial adapter. In a second round of PCR, 2ul of first round product was amplified in duplicate for 20 cycles with the same forward primer and an indexed reverse primer that completed addition of the reverse NGS adapter. After combining replicates, 5ul of each sample was run on a gel, and the amplicon concentration was estimated via densitometry. Samples were then combined in equal proportions, run together on a gel, and the amplicon was extracted, purified, and submitted for amplicon-sequencing. The same approach, excluding reverse transcription which is not applicable, was used to prepare amplicons from mouse genomic DNA, with the following differences: 1) The forward primer for the first round of amplification targeted an upstream region of the Tnni1 gene, outside the 5’ homology arm, while the reverse primer targeted a region just downstream of the insertion, within the 3’ homology arm, and added a partial NGS adapter (Fig. 4B, black arrows). 2) In the second round of amplification the forward primer targeted the insertion priming site located between the enhancer and barcode (same primer as for RNA), while the reverse primer added a multiplexing index and completed the adapter. See Supplemental table 1 for primer sequences. NGS sequences were trimmed to remove non-barcode sequences, and then the number of times each barcode occurred in each sample was quantified. These readcounts were used to calculate reads per million (RPM), and activity was calculated as the ratio between barcode frequency in RNA versus DNA. Normalized activity (for comparison to episomal MPRA data) was calculated by multiplying activity data by an adjustment factor, such that the average of the endothelial enhancer group was equal to one. NGS processing script is available on Github (see data availability statement).

Episomal MPRAs
Barcoded enhancers and promoters were cloned into the MPRA vector as shown in Fig. S3D. The plasmid pool was used to produce a single AAV9 library, which was subcutaneously injected into six newborn mice with cardiomyocyte specific activation of Cas9, as described above. Hearts were collected at P28 and RNA was isolated from whole ventricles. RNA was reverse transcribed with Oligo-dT priming. For DNA samples, DNA was isolated from untransduced AAV via Proteinase-K digestion of the viral capsid, in three technical replicates, as previously described21,65. RNA and DNA samples were amplified in two rounds of PCR (see Supplemental table 1 for primers), and submitted for amplicon-sequencing as described above. Promoter--enhancer barcode combinations were quantified, and normalized for sequencing depth (CPM). Normalized activity was calculated as described above for all enhancer-promoter pairs that were present at >30 CPM in all DNA replicates. NGS processing script is available on Github (see data availability statement).

